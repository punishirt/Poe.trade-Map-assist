// ==UserScript==
// @name         poe.trade map-assist
// @namespace    http://tampermonkey.net/
// @version      0.4
// @description  Simple script to assist with searching for maps.
// @author       https://www.reddit.com/user/punishirt
// @match        http://poe.trade/*
// @match        https://poe.trade/*
// @grant        GM_getValue
// @grant        GM_setValue
// @grant        GM_addStyle
// @require http://code.jquery.com/jquery-3.3.1.slim.min.js
// ==/UserScript==

(function() {
    'use strict';

    /*
    // snippet used to create maps list (run on https://pathofexile.gamepedia.com/List_of_base_maps)
    for(var x = 0;x < 16;x++) { mapsList.push([]) };

    jQuery(".item-table tbody tr").each( function(idx) {
        var row = jQuery(this);
        var mapSrc = jQuery('td:eq( 0 ) .c-item-hoverbox__display', row);
        var mapImg = mapSrc.find('img').attr('src');
        var mapName = mapSrc.find('span:eq(0) span:eq(0)').html();
        var tier = +jQuery('td:eq( 1 ) em', row).html();

        mapsList[tier-1].push( {
            tier: tier,
            map: mapName,
            icon: mapImg
        });
    });*/

    var GAME_VERSION = '3.5.1';
    var baseMapsList = [[{"tier":1,"map":"Atoll Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/b/b4/Atoll_Map_%28Betrayal%29_inventory_icon.png?version=89363b4427419770db3bae0fa975f77d","id":"map-1-0"},{"tier":1,"map":"Channel Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/e/e0/Channel_Map_%28Betrayal%29_inventory_icon.png?version=3f0821740ae1cf1db87891ecea2ff207","id":"map-1-1"},{"tier":1,"map":"Flooded Mine Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/b/bb/Flooded_Mine_Map_%28Betrayal%29_inventory_icon.png?version=65da213bd61c551cf8b3e74d4fc56434","id":"map-1-2"},{"tier":1,"map":"Ramparts Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/6/6d/Ramparts_Map_%28Betrayal%29_inventory_icon.png?version=91156409ccd4db50e48fcd5ca6b3337d","id":"map-1-3"}],[{"tier":2,"map":"Arid Lake Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/f/f8/Arid_Lake_Map_%28Betrayal%29_inventory_icon.png?version=d5987e43a5eb3182e17067d39642907b","id":"map-2-4"},{"tier":2,"map":"Armoury Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/4/47/Armoury_Map_%28Betrayal%29_inventory_icon.png?version=5361f3fa703157419895043f88f71c1b","id":"map-2-5"},{"tier":2,"map":"Dungeon Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/0/08/Dungeon_Map_%28Betrayal%29_inventory_icon.png?version=198a522a2fac74fb478c3e1dfac4a840","id":"map-2-6"},{"tier":2,"map":"Iceberg Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/2/20/Iceberg_Map_%28Betrayal%29_inventory_icon.png?version=e0a83484971e3b4d89c6ec3d531f5353","id":"map-2-7"},{"tier":2,"map":"Pen Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/3/36/Pen_Map_%28Betrayal%29_inventory_icon.png?version=51269b4c986c9694a915bca7ff48d8ba","id":"map-2-8"},{"tier":2,"map":"Thicket Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/9/90/Thicket_Map_%28Betrayal%29_inventory_icon.png?version=7e5a82f3a8b0cff7877a67ae73893bc9","id":"map-2-9"}],[{"tier":3,"map":"Bone Crypt Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/4/4e/Bone_Crypt_Map_%28Betrayal%29_inventory_icon.png?version=d2327d8df1c8499e19d23d65e56edafe","id":"map-3-10"},{"tier":3,"map":"Cage Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/d/d7/Cage_Map_%28Betrayal%29_inventory_icon.png?version=b57eefcd31fdb4ec39574edb1035a183","id":"map-3-11"},{"tier":3,"map":"Cursed Crypt Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/b/b3/Cursed_Crypt_Map_%28Betrayal%29_inventory_icon.png?version=b735c3dd176b629cad1c9793e3daf4f3","id":"map-3-12"},{"tier":3,"map":"Desert Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/0/0f/Desert_Map_%28Betrayal%29_inventory_icon.png?version=bf796b7937a247be5e369c3ed171d78d","id":"map-3-13"},{"tier":3,"map":"Excavation Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/4/48/Excavation_Map_%28Betrayal%29_inventory_icon.png?version=3b9b4e8357e6c69fcd1d2685ac1051cb","id":"map-3-14"},{"tier":3,"map":"Fungal Hollow Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/a/a8/Fungal_Hollow_Map_%28Betrayal%29_inventory_icon.png?version=245385e762fffffdc11d3fecd927e6c1","id":"map-3-15"},{"tier":3,"map":"Graveyard Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/5/53/Graveyard_Map_%28Betrayal%29_inventory_icon.png?version=2bc8644b91aefa688915d85b0447dfa4","id":"map-3-16"},{"tier":3,"map":"Grotto Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/5/51/Grotto_Map_%28Betrayal%29_inventory_icon.png?version=f5069589a2b86ba69e943698fb3d4dac","id":"map-3-17"},{"tier":3,"map":"Peninsula Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/4/41/Peninsula_Map_%28Betrayal%29_inventory_icon.png?version=fe32d15cb3cfb9318d0e78f10c5c6837","id":"map-3-18"},{"tier":3,"map":"Shipyard Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/a/a1/Shipyard_Map_%28Betrayal%29_inventory_icon.png?version=eefeb521441605d7845e381179fc355f","id":"map-3-19"}],[{"tier":4,"map":"Barrows Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/6/6c/Barrows_Map_%28Betrayal%29_inventory_icon.png?version=9d12da13a18a11e01441966681f72943","id":"map-4-20"},{"tier":4,"map":"Beach Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/f/f8/Beach_Map_%28Betrayal%29_inventory_icon.png?version=78cb31cf147cf6c4501d4163b5917142","id":"map-4-21"},{"tier":4,"map":"Courtyard Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/4/4b/Courtyard_Map_%28Betrayal%29_inventory_icon.png?version=38792e9dac68731be627fdecc34d546b","id":"map-4-22"},{"tier":4,"map":"Crater Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/5/54/Crater_Map_%28Betrayal%29_inventory_icon.png?version=995dad7c0da4305a83a791dd0a03f6cf","id":"map-4-23"},{"tier":4,"map":"Glacier Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/3/36/Glacier_Map_%28Betrayal%29_inventory_icon.png?version=8d61e689309efe56d88937ba5c3d4b8f","id":"map-4-24"},{"tier":4,"map":"Lighthouse Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/a/a8/Lighthouse_Map_%28Betrayal%29_inventory_icon.png?version=5352525428b140fb7a5120e2e6ddd0ef","id":"map-4-25"},{"tier":4,"map":"Lookout Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/9/94/Lookout_Map_%28Betrayal%29_inventory_icon.png?version=3c8066c345df7cd66fab509aa2b7b1af","id":"map-4-26"},{"tier":4,"map":"Marshes Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/9/98/Marshes_Map_%28Betrayal%29_inventory_icon.png?version=0db72744c1056969016d53e80fd8abf6","id":"map-4-27"},{"tier":4,"map":"Spider Lair Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/c/c9/Spider_Lair_Map_%28Betrayal%29_inventory_icon.png?version=8ebb351262c412c423ab03205a210f51","id":"map-4-28"},{"tier":4,"map":"Strand Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/a/a5/Strand_Map_%28Betrayal%29_inventory_icon.png?version=9d9338e7bce9cfd20e3038ba4eea5464","id":"map-4-29"}],[{"tier":5,"map":"Alleyways Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/5/58/Alleyways_Map_%28Betrayal%29_inventory_icon.png?version=385410e6185ad8aa1b047f9081a39542","id":"map-5-30"},{"tier":5,"map":"City Square Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/e/e6/City_Square_Map_%28Betrayal%29_inventory_icon.png?version=84075c4ae9be8f420e40bede8203611b","id":"map-5-31"},{"tier":5,"map":"Gardens Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/2/25/Gardens_Map_%28Betrayal%29_inventory_icon.png?version=81908fe36f8fa9ebe330226de4fc6206","id":"map-5-32"},{"tier":5,"map":"Jungle Valley Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/9/96/Jungle_Valley_Map_%28Betrayal%29_inventory_icon.png?version=4a89d6493b8786ebe14a64dedd9e7b0b","id":"map-5-33"},{"tier":5,"map":"Mausoleum Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/b/b7/Mausoleum_Map_%28Betrayal%29_inventory_icon.png?version=bf0eaa7436041d3c5c5021129d9931eb","id":"map-5-34"},{"tier":5,"map":"Maze Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/1/15/Maze_Map_%28Betrayal%29_inventory_icon.png?version=524dd2e97ce84e868081a9c4f6bf9110","id":"map-5-35"},{"tier":5,"map":"Port Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/2/2d/Port_Map_%28Betrayal%29_inventory_icon.png?version=58105638ef07f9cbce5c52a2fc6105d4","id":"map-5-36"},{"tier":5,"map":"Residence Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/0/03/Residence_Map_%28Betrayal%29_inventory_icon.png?version=892ac7baefdf79fe54f110681b7b81c4","id":"map-5-37"},{"tier":5,"map":"Underground Sea Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/3/3b/Underground_Sea_Map_%28Betrayal%29_inventory_icon.png?version=4d84417291ad9a8f83aa6accb2386b72","id":"map-5-38"},{"tier":5,"map":"Vaal Pyramid Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/7/71/Vaal_Pyramid_Map_%28Betrayal%29_inventory_icon.png?version=0047eb3151779487924bb464e550acd7","id":"map-5-39"}],[{"tier":6,"map":"Academy Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/8/84/Academy_Map_%28Betrayal%29_inventory_icon.png?version=290134aafede25064ec5c148ee2af433","id":"map-6-40"},{"tier":6,"map":"Ashen Wood Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/1/1d/Ashen_Wood_Map_%28Betrayal%29_inventory_icon.png?version=c454fc8cb253615159c9084ad145b927","id":"map-6-41"},{"tier":6,"map":"Canyon Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/7/71/Canyon_Map_%28Betrayal%29_inventory_icon.png?version=0f71d2ef2fdb5f50f901be50bdde8e96","id":"map-6-42"},{"tier":6,"map":"Fields Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/0/06/Fields_Map_%28Betrayal%29_inventory_icon.png?version=6ebc3fc1cf080caa46e100a09939d612","id":"map-6-43"},{"tier":6,"map":"Haunted Mansion Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/6/69/Haunted_Mansion_Map_%28Betrayal%29_inventory_icon.png?version=20d46afbdba393812c5304a8ad1c7900","id":"map-6-44"},{"tier":6,"map":"Phantasmagoria Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/e/ee/Phantasmagoria_Map_%28Betrayal%29_inventory_icon.png?version=877617c743278468bdfdf23d7229ba74","id":"map-6-45"},{"tier":6,"map":"Precinct Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/e/ee/Precinct_Map_%28Betrayal%29_inventory_icon.png?version=5da50e731afa9969e66dabfbd39d2a30","id":"map-6-46"},{"tier":6,"map":"Sulphur Vents Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/0/09/Sulphur_Vents_Map_%28Betrayal%29_inventory_icon.png?version=1f8da6f2093acd5ed24317b1d6fedde4","id":"map-6-47"},{"tier":6,"map":"Temple Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/7/72/Temple_Map_%28Betrayal%29_inventory_icon.png?version=46cf53158d6f614df19387bbef8e40ca","id":"map-6-48"},{"tier":6,"map":"Volcano Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/8/85/Volcano_Map_%28Betrayal%29_inventory_icon.png?version=df35fa6e28fe3155faab4db67a916079","id":"map-6-49"},{"tier":6,"map":"Wharf Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/8/80/Wharf_Map_%28Betrayal%29_inventory_icon.png?version=ea617310b1f7ee5f0519ba65d71c8c27","id":"map-6-50"}],[{"tier":7,"map":"Arcade Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/e/e3/Arcade_Map_%28Betrayal%29_inventory_icon.png?version=e21d86d2ae6d85ba4da77292294007d9","id":"map-7-51"},{"tier":7,"map":"Bazaar Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/7/71/Bazaar_Map_%28Betrayal%29_inventory_icon.png?version=0d4888d6590e8333a8526d9e6fc02d16","id":"map-7-52"},{"tier":7,"map":"Cells Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/9/9e/Cells_Map_%28Betrayal%29_inventory_icon.png?version=0b4b227381ed6bf9072a95229d9f33b7","id":"map-7-53"},{"tier":7,"map":"Conservatory Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/c/c0/Conservatory_Map_%28Betrayal%29_inventory_icon.png?version=e12ded2cd58ecaabf27f8a0856c1f61e","id":"map-7-54"},{"tier":7,"map":"Dunes Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/7/71/Dunes_Map_%28Betrayal%29_inventory_icon.png?version=023e6ee521fe1f2220e8e4012e25e606","id":"map-7-55"},{"tier":7,"map":"Geode Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/5/57/Geode_Map_%28Betrayal%29_inventory_icon.png?version=ec30b9aa09cf59269f2afbf9fd122201","id":"map-7-56"},{"tier":7,"map":"Ghetto Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/7/7f/Ghetto_Map_%28Betrayal%29_inventory_icon.png?version=7d29214c32ee738506a585e6f8eb65b7","id":"map-7-57"},{"tier":7,"map":"Lava Chamber Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/2/2d/Lava_Chamber_Map_%28Betrayal%29_inventory_icon.png?version=3af46b3d1de2012c7b975cde4c75a114","id":"map-7-58"},{"tier":7,"map":"Primordial Pool Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/8/8f/Primordial_Pool_Map_%28Betrayal%29_inventory_icon.png?version=f03c15708a20535198fa04934c782300","id":"map-7-59"},{"tier":7,"map":"Toxic Sewer Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/5/57/Toxic_Sewer_Map_%28Betrayal%29_inventory_icon.png?version=23ed1d67fe13a5fa873ba600dd787f62","id":"map-7-60"},{"tier":7,"map":"Underground River Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/7/78/Underground_River_Map_%28Betrayal%29_inventory_icon.png?version=44a6d19961ca2024e35f25d1e02149d1","id":"map-7-61"}],[{"tier":8,"map":"Arachnid Nest Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/1/17/Arachnid_Nest_Map_%28Betrayal%29_inventory_icon.png?version=5f85adb440a1e5ac3b57c2fb57355fa2","id":"map-8-62"},{"tier":8,"map":"Infested Valley Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/5/52/Infested_Valley_Map_%28Betrayal%29_inventory_icon.png?version=7725b83d92e36633f375a60d3ee1573b","id":"map-8-63"},{"tier":8,"map":"Laboratory Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/0/0d/Laboratory_Map_%28Betrayal%29_inventory_icon.png?version=dbfa22c68df038a0c6fe83a210ff3166","id":"map-8-64"},{"tier":8,"map":"Mineral Pools Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/6/63/Mineral_Pools_Map_%28Betrayal%29_inventory_icon.png?version=5b42ec884a29dfa82e522d3c4f3bc16c","id":"map-8-65"},{"tier":8,"map":"Mud Geyser Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/1/1b/Mud_Geyser_Map_%28Betrayal%29_inventory_icon.png?version=8a9b73cdf0bc1f5056d3ade36fef508a","id":"map-8-66"},{"tier":8,"map":"Orchard Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/4/4f/Orchard_Map_%28Betrayal%29_inventory_icon.png?version=0aa3aec4f197bca77f97f5b3e2171536","id":"map-8-67"},{"tier":8,"map":"Overgrown Ruin Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/0/03/Overgrown_Ruin_Map_%28Betrayal%29_inventory_icon.png?version=d37dc9d8a7c9b1a9df005598d8362259","id":"map-8-68"},{"tier":8,"map":"Promenade Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/f/f5/Promenade_Map_%28Betrayal%29_inventory_icon.png?version=2705412fec919bf5ca60d760cc4e2e09","id":"map-8-69"},{"tier":8,"map":"Sepulchre Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/4/48/Sepulchre_Map_%28Betrayal%29_inventory_icon.png?version=0e7bdd5a606a634ea7ccd06ab8f6d67e","id":"map-8-70"},{"tier":8,"map":"Shore Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/9/9a/Shore_Map_%28Betrayal%29_inventory_icon.png?version=ccce00276a5b2c22d5a554baefdec1b9","id":"map-8-71"},{"tier":8,"map":"Wasteland Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/6/6c/Wasteland_Map_%28Betrayal%29_inventory_icon.png?version=d4f205de3a976cac85632e460ab608b5","id":"map-8-72"}],[{"tier":9,"map":"Ancient City Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/f/f9/Ancient_City_Map_%28Betrayal%29_inventory_icon.png?version=9c9779e1f60602bba097a7d3e24b9147","id":"map-9-73"},{"tier":9,"map":"Arena Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/8/8c/Arena_Map_%28Betrayal%29_inventory_icon.png?version=d9b862f14305740276bfe6980f9a1d59","id":"map-9-74"},{"tier":9,"map":"Cemetery Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/d/d0/Cemetery_Map_%28Betrayal%29_inventory_icon.png?version=5f54ce18641283644f13b5093fddb79e","id":"map-9-75"},{"tier":9,"map":"Moon Temple Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/b/ba/Moon_Temple_Map_%28Betrayal%29_inventory_icon.png?version=262d04d007ac8576749581375e3325a0","id":"map-9-76"},{"tier":9,"map":"Museum Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/b/be/Museum_Map_%28Betrayal%29_inventory_icon.png?version=755db5e0b823c68dc0d78cb09c509c8e","id":"map-9-77"},{"tier":9,"map":"Relic Chambers Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/6/63/Relic_Chambers_Map_%28Betrayal%29_inventory_icon.png?version=ad6021c3ecdede4dc7fdb350a0a27c48","id":"map-9-78"},{"tier":9,"map":"Scriptorium Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/4/48/Scriptorium_Map_%28Betrayal%29_inventory_icon.png?version=c1d6af7c2f473402bad35ae2520517f9","id":"map-9-79"},{"tier":9,"map":"Tropical Island Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/d/d6/Tropical_Island_Map_%28Betrayal%29_inventory_icon.png?version=00ef51aa6707668653ac75e776acb177","id":"map-9-80"},{"tier":9,"map":"Vault Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/a/a5/Vault_Map_%28Betrayal%29_inventory_icon.png?version=96bb860148acbf38340942bf717efadf","id":"map-9-81"},{"tier":9,"map":"Waste Pool Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/0/00/Waste_Pool_Map_%28Betrayal%29_inventory_icon.png?version=172ff84c48c6826b487d10e6081aaff5","id":"map-9-82"},{"tier":9,"map":"Waterways Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/1/11/Waterways_Map_%28Betrayal%29_inventory_icon.png?version=7358bca2dd73c67fdddabd5eb27bf4db","id":"map-9-83"}],[{"tier":10,"map":"Belfry Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/3/3d/Belfry_Map_%28Betrayal%29_inventory_icon.png?version=92039744cce5f7bb4e2134e3daaa1a42","id":"map-10-84"},{"tier":10,"map":"Coral Ruins Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/5/57/Coral_Ruins_Map_%28Betrayal%29_inventory_icon.png?version=2ecfc5793802413d1d934102467c84d5","id":"map-10-85"},{"tier":10,"map":"Coves Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/6/6e/Coves_Map_%28Betrayal%29_inventory_icon.png?version=653af61be49a4ca574ed2a2ef7af9ec0","id":"map-10-86"},{"tier":10,"map":"Estuary Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/d/df/Estuary_Map_%28Betrayal%29_inventory_icon.png?version=49a997af48f55aeda0786fa8b3aec79e","id":"map-10-87"},{"tier":10,"map":"Leyline Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/0/02/Leyline_Map_%28Betrayal%29_inventory_icon.png?version=aa716a7a6f6f728d51f85830ee122043","id":"map-10-88"},{"tier":10,"map":"Pier Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/d/df/Pier_Map_%28Betrayal%29_inventory_icon.png?version=3b06d2c27a16477be8a43770320ca4ed","id":"map-10-89"},{"tier":10,"map":"Pit Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/1/1e/Pit_Map_%28Betrayal%29_inventory_icon.png?version=252f33d63f9be8ed70adebce0ef9b265","id":"map-10-90"},{"tier":10,"map":"Plateau Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/c/ca/Plateau_Map_%28Betrayal%29_inventory_icon.png?version=28bcbc25b768398cdee653d88771a43a","id":"map-10-91"},{"tier":10,"map":"Plaza Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/2/22/Plaza_Map_%28Betrayal%29_inventory_icon.png?version=dc06de6f3c424cbaa0b7809d262d0216","id":"map-10-92"},{"tier":10,"map":"Spider Forest Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/9/9c/Spider_Forest_Map_%28Betrayal%29_inventory_icon.png?version=ffc09854d3c92ad730b29e04d3310067","id":"map-10-93"}],[{"tier":11,"map":"Arachnid Tomb Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/9/9c/Arachnid_Tomb_Map_%28Betrayal%29_inventory_icon.png?version=136f88ae47bdc45e806ec0d53141ebe0","id":"map-11-94"},{"tier":11,"map":"Bog Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/4/4f/Bog_Map_%28Betrayal%29_inventory_icon.png?version=3ba98674005fdd15c4f8858b7750be19","id":"map-11-95"},{"tier":11,"map":"Burial Chambers Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/0/09/Burial_Chambers_Map_%28Betrayal%29_inventory_icon.png?version=4b41b1190a872cfef8c0000504cc599d","id":"map-11-96"},{"tier":11,"map":"Chateau Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/4/44/Chateau_Map_%28Betrayal%29_inventory_icon.png?version=f5183b15c6f3c633fb5c1668e7425140","id":"map-11-97"},{"tier":11,"map":"Crystal Ore Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/8/85/Crystal_Ore_Map_%28Betrayal%29_inventory_icon.png?version=378cd356c81378dba49a1bd97d77e507","id":"map-11-98"},{"tier":11,"map":"Factory Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/a/a8/Factory_Map_%28Betrayal%29_inventory_icon.png?version=d7998015bd7661635f23736091705cfd","id":"map-11-99"},{"tier":11,"map":"Lair Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/e/e2/Lair_Map_%28Betrayal%29_inventory_icon.png?version=347d74ae693ffbdb67c25c333eb4b0bd","id":"map-11-100"},{"tier":11,"map":"Mesa Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/b/b8/Mesa_Map_%28Betrayal%29_inventory_icon.png?version=ca84d782f900a75d96b7e49c175d4ca9","id":"map-11-101"},{"tier":11,"map":"Park Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/2/24/Park_Map_%28Betrayal%29_inventory_icon.png?version=2941f7913fd142abd7349b06ee33a38e","id":"map-11-102"},{"tier":11,"map":"Siege Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/9/9f/Siege_Map_%28Betrayal%29_inventory_icon.png?version=a5b9c93197529ed1a4d7e45ae0eef4f7","id":"map-11-103"}],[{"tier":12,"map":"Arsenal Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/b/b6/Arsenal_Map_%28Betrayal%29_inventory_icon.png?version=10f6d0eeaf5f516253401fefbf7c87f3","id":"map-12-104"},{"tier":12,"map":"Castle Ruins Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/6/6e/Castle_Ruins_Map_%28Betrayal%29_inventory_icon.png?version=8e7ad9310da56341f07aa2e1bfab15af","id":"map-12-105"},{"tier":12,"map":"Colonnade Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/7/7f/Colonnade_Map_%28Betrayal%29_inventory_icon.png?version=f28fc74504bb820269b2a81f46179ad4","id":"map-12-106"},{"tier":12,"map":"Defiled Cathedral Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/9/96/Defiled_Cathedral_Map_%28Betrayal%29_inventory_icon.png?version=eb130edc192adab65222f933f8d4cf1d","id":"map-12-107"},{"tier":12,"map":"Ivory Temple Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/3/34/Ivory_Temple_Map_%28Betrayal%29_inventory_icon.png?version=f16ceed9f0c6f6dc2b4173908b076854","id":"map-12-108"},{"tier":12,"map":"Malformation Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/a/a1/Malformation_Map_%28Betrayal%29_inventory_icon.png?version=02cbe0aae4e4c27cd8749ca013efe25f","id":"map-12-109"},{"tier":12,"map":"Necropolis Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/d/db/Necropolis_Map_%28Betrayal%29_inventory_icon.png?version=ce65d189de1446466b1ab2cba56db2e6","id":"map-12-110"},{"tier":12,"map":"Overgrown Shrine Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/d/d5/Overgrown_Shrine_Map_%28Betrayal%29_inventory_icon.png?version=45c102775ca6bb4c9cf92f380f8b53ce","id":"map-12-111"},{"tier":12,"map":"Villa Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/e/eb/Villa_Map_%28Betrayal%29_inventory_icon.png?version=ff6491a99908a9bafa9300e9cb347c1b","id":"map-12-112"}],[{"tier":13,"map":"Acid Caverns Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/3/38/Acid_Caverns_Map_%28Betrayal%29_inventory_icon.png?version=130c8a02aab740a8e4e89a504b227a82","id":"map-13-113"},{"tier":13,"map":"Caldera Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/9/9c/Caldera_Map_%28Betrayal%29_inventory_icon.png?version=20c42543c23fd4caed7a36b33545fa76","id":"map-13-114"},{"tier":13,"map":"Colosseum Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/2/26/Colosseum_Map_%28Betrayal%29_inventory_icon.png?version=7f5a33793eefeb9316b14277236fb503","id":"map-13-115"},{"tier":13,"map":"Core Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/f/f6/Core_Map_%28Betrayal%29_inventory_icon.png?version=98b46d3ea704e0a3dbaf6c549d4d1d91","id":"map-13-116"},{"tier":13,"map":"Crimson Temple Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/f/f9/Crimson_Temple_Map_%28Betrayal%29_inventory_icon.png?version=d0a68d71b8b18b0660aafeca4dbea295","id":"map-13-117"},{"tier":13,"map":"Dig Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/4/48/Dig_Map_%28Betrayal%29_inventory_icon.png?version=05a08ed960246cc80ccc2d5a3e111140","id":"map-13-118"},{"tier":13,"map":"Racecourse Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/2/28/Racecourse_Map_%28Betrayal%29_inventory_icon.png?version=4850630c95ff9c1785297f79fd7e2f3e","id":"map-13-119"},{"tier":13,"map":"Reef Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/f/f5/Reef_Map_%28Betrayal%29_inventory_icon.png?version=f4bb5496be04f76fc5cc42febee6daea","id":"map-13-120"},{"tier":13,"map":"Shrine Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/b/bb/Shrine_Map_%28Betrayal%29_inventory_icon.png?version=2cba011208302e85d297bf290b2ffb0a","id":"map-13-121"}],[{"tier":14,"map":"Basilica Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/4/4a/Basilica_Map_%28Betrayal%29_inventory_icon.png?version=75a6e399d1db4bdeeb93c357baf12644","id":"map-14-122"},{"tier":14,"map":"Carcass Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/8/80/Carcass_Map_%28Betrayal%29_inventory_icon.png?version=fcfa2e0f98667125623560bd9f827963","id":"map-14-123"},{"tier":14,"map":"Courthouse Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/e/ed/Courthouse_Map_%28Betrayal%29_inventory_icon.png?version=c584c4aeca76e80548a03b1eb9044e94","id":"map-14-124"},{"tier":14,"map":"Dark Forest Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/0/08/Dark_Forest_Map_%28Betrayal%29_inventory_icon.png?version=84f99eb78919c5ca598014bf6b683fb5","id":"map-14-125"},{"tier":14,"map":"Palace Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/e/e0/Palace_Map_%28Betrayal%29_inventory_icon.png?version=e61e48fae68b4822bf0a459f030bc260","id":"map-14-126"},{"tier":14,"map":"Sunken City Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/1/1e/Sunken_City_Map_%28Betrayal%29_inventory_icon.png?version=a27eb3ad9f0aef5f1d79b87395cc3b2d","id":"map-14-127"},{"tier":14,"map":"Terrace Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/6/62/Terrace_Map_%28Betrayal%29_inventory_icon.png?version=a2fe2a9033268be93694f0469ff1559f","id":"map-14-128"}],[{"tier":15,"map":"Desert Spring Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/b/bb/Desert_Spring_Map_%28Betrayal%29_inventory_icon.png?version=cd38148080cbe942a6e796cf35f6bc40","id":"map-15-129"},{"tier":15,"map":"Lava Lake Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/3/34/Lava_Lake_Map_%28Betrayal%29_inventory_icon.png?version=0d497065d212728654d3e7cf11e30e56","id":"map-15-130"},{"tier":15,"map":"Primordial Blocks Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/d/dc/Primordial_Blocks_Map_%28Betrayal%29_inventory_icon.png?version=012bd833c0f7ea88010088188e7e3aca","id":"map-15-131"},{"tier":15,"map":"Summit Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/a/ad/Summit_Map_%28Betrayal%29_inventory_icon.png?version=088cc4aa7ca3078cb11a4f477e7b3e90","id":"map-15-132"},{"tier":15,"map":"Tower Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/f/f0/Tower_Map_%28Betrayal%29_inventory_icon.png?version=e9d555f6cd9f56f95f59db13487db9f6","id":"map-15-133"}],[{"tier":16,"map":"Forge of the Phoenix Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/f/f4/Forge_of_the_Phoenix_Map_%28Betrayal%29_inventory_icon.png?version=db5e3f1b848dfa8a4591d7f84c102202","id":"map-16-134"},{"tier":16,"map":"Lair of the Hydra Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/2/27/Lair_of_the_Hydra_Map_%28Betrayal%29_inventory_icon.png?version=621efb898a3b21762a147fa59caec606","id":"map-16-135"},{"tier":16,"map":"Maze of the Minotaur Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/9/9b/Maze_of_the_Minotaur_Map_%28Betrayal%29_inventory_icon.png?version=5cadf63075bc0b5f7e6090c4727f5b3c","id":"map-16-136"},{"tier":16,"map":"Pit of the Chimera Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/7/7e/Pit_of_the_Chimera_Map_%28Betrayal%29_inventory_icon.png?version=a056e10af0615519cfbb6c883f4e0560","id":"map-16-137"},{"tier":16,"map":"Vaal Temple Map","icon":"https://d1u5p3l4wpay3k.cloudfront.net/pathofexile_gamepedia/3/3f/Vaal_Temple_Map_%28Betrayal%29_inventory_icon.png?version=989fa6411fecab123156f6ba4014069f","id":"map-16-138"}]];
    var mapsList = [];

    GM_addStyle("#map-list-ct { width: 130px; overflow-y: hidden; overflow-y: auto;height: 100vh; position: fixed; top: 0px; left: 0px; background: #0F0F0F; border-right: 2px solid rgba(255, 255, 255, 0.2); }");
    GM_addStyle("#map-list-ct .reset-maps-link { text-align: center; color: orange; text-decoration: underline;  background: black;  border-top: 2px solid rgba(255, 255, 255, 0.3);  padding: 10px 5px; cursor: pointer;}");
    GM_addStyle("ul.map-list { list-style: none; }");
    GM_addStyle("ul.map-list li { max-width: 80%; text-align: center; margin: 0 auto; }");
    GM_addStyle("ul.map-list li { max-width: 80%; text-align: center; margin: 0 auto; }");
    GM_addStyle("ul.map-list li h6 { font-size: 12px !important; color: orange; }");
    GM_addStyle("ul.map-list li img { max-width: 50px; cursor: pointer; }");
    GM_addStyle("ul.map-list li.hidden-map { opacity: 0.3; }");

    var updateSearch = function() {
        var mapImg = jQuery(this);
        var el = jQuery('#search-form');
        if (el.css('display') == "block") {
            jQuery('#toggle-search-form').click();
        }
        jQuery("#name").val(mapImg.attr('data-map-name')).trigger('change');
        jQuery("#search").submit();
    }

    var sortEnabledMaps = function (a, b){
        var a1 = a.order ? a.order : 1;
        var b1 = b.order ? b.order : 1;
        return ((a1 < b1) ? 1 : ((a1 > b1) ? -1 : 0));
    }


    var toggleMap = function() {
        var el = jQuery(this);
        var id = el.attr('id');
        var tier = +id.split('-')[1] - 1;
        for(var x = 0;x < mapsList[tier].length;x++) {
            var order = mapsList[tier][x].order;
            if( mapsList[tier][x].id === id) {
                mapsList[tier][x].order = order ? order * -1 : -1;
            }
        }
        mapsList[tier].sort(sortEnabledMaps);
        renderMaps();
        GM_setValue('mapsList'+GAME_VERSION, JSON.stringify(mapsList));
        return false;
    };

    var resetMaps = function() {
        mapsList = JSON.parse(JSON.stringify(baseMapsList));
        GM_setValue('mapsList'+GAME_VERSION, JSON.stringify(mapsList));
        renderMaps();
    }

    var getMapSelectionForTier = function(selectedTier) {
        if ( selectedTier !== 42 ) return mapsList[selectedTier];
        var selection = [];
        for(var tier = 0;tier < mapsList.length;tier++) {
            for(var x = 0;x < mapsList[tier].length;x++) {
                var order = mapsList[tier][x].order;
                if( !order || order === 1) {
                    selection.push(mapsList[tier][x]);
                }
            }
        }
        console.log(selection, selectedTier);
        return selection;
    }

    var renderMaps = function() {

        var tierUl = jQuery('.map-list');
        tierUl.empty();

        var selectedTier = +jQuery('.map-tier-selector:eq(0)').val();
        GM_setValue('lastTier'+GAME_VERSION, selectedTier);

        var mapSelection = getMapSelectionForTier(selectedTier);
        mapSelection.sort(sortEnabledMaps);

        for (var x = 0;x < mapSelection.length;x++ ) {
            var map = mapSelection[x];
            var stateCls = map.order == -1 ? 'hidden-map' : '';
            var mapDetails = jQuery('<li></li>').addClass('map-details').addClass(stateCls);

            mapDetails.append( jQuery('<h6></h6>').html(map.map) );
            mapDetails.append( jQuery('<img></img>').attr('src', map.icon).attr('id', map.id).attr('data-map-name', map.map) );
            tierUl.append(mapDetails);
        }
        jQuery('.map-details img').contextmenu(toggleMap);
        jQuery('.map-details img').click(updateSearch);
    }

    var initMapHelper = function() {
        var list = GM_getValue('mapsList' + GAME_VERSION);
        var lastTier = GM_getValue('lastTier' + GAME_VERSION);
        if(!list) {
            list = JSON.stringify(baseMapsList);
            GM_setValue('mapsList' + GAME_VERSION, list);
        }
        mapsList = JSON.parse(list);


        var ct = jQuery('<div></div>').attr('id', 'map-list-ct');
        jQuery('body').append(ct);

        var tierSelector = jQuery('<select></select>').addClass('map-tier-selector');
        for(var x = 0;x < mapsList.length;x++) {
            tierSelector.append( jQuery('<option></option>').val(x).html('Tier ' + (x+1)));
        }
        tierSelector.append( jQuery('<option></option>').val(42).html('Uncompleted'));
        ct.append(tierSelector);

        if(!lastTier) {
            lastTier = 0;
        } else {
            jQuery('.map-tier-selector:eq(0)').val(+lastTier);
        }
        tierSelector.change(renderMaps);

        var tierUl = jQuery('<ul></ul>').addClass('map-list');
        jQuery('#map-list-ct').append(tierUl);

        renderMaps();

        var resetMapsEl = jQuery("<div></div>").html('reset maps').css({'text-align': 'center', 'color': 'orange', 'text-decoration': 'underline'}).addClass('reset-maps-link');
        resetMapsEl.click(resetMaps);
        ct.append(resetMapsEl);
    }

    initMapHelper();
})();
